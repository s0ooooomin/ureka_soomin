<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<h1>register.html</h1>
	<hr>
	<!-- login.html 은 username, register.html name <= UserDto 를 사용 -->
	name : <input type="text" id="name" name="name"><br>
	email : <input type="text" id="email" name="email"><br>
	Password : <input type="text" id="password" name="password"><br>
	<!-- 비밀번호 확인 X -->
	
	<!-- csrf token -->
	<input type="hidden" id="_csrf" name="_csrf" value=""><br>
	
	<button id="btnRegister">Register</button>

<script>
	window.onload = function(){
		getCsrfToken();
		
		document.querySelector("#btnRegister").onclick = register;
	}
	
	// csrf controller 에 token 요청
	async function getCsrfToken(){
		let response = await fetch("/csrf-token", {method: "get", credentials: "same-origin"});
		console.log(response);
		let data = await response.json();
		console.log(data);
		document.querySelector("#_csrf").value = data.token;
	}
	
	// 로그인 
	async function register(){
		
		let url = "/users";
		
		let name = document.querySelector("#name").value;
		let email = document.querySelector("#email").value;
		let password = document.querySelector("#password").value;
		let _csrf = document.querySelector("#_csrf").value;
		
		let urlParams = new URLSearchParams({
			name, email, password, _csrf  // javascript es6 shorthand property 문법
		});
		
		let fetchOptions = {
			method: "post",
			body: urlParams
		}
		
		let response = await fetch(url, fetchOptions);
		let data = await response.json();
		
		console.log(data);
		
		// 로그인 결과에 따른 처리
		if( data.result == "success" ){
			alert("회원가입 되었습니다. 로그인 페이지로 이동합니다.");
			window.location.href = "/login";
		}else{
			alert("회원가입 과정에서 오류가 발생했습니다.")
		}
	}
	
</script>	
</body>
</html>
<!-- csrf 설정 후 받은 token 을 전송해야 함. login2.html 로 변경 후 새로운 login.html 생성 -->
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
</head>
<body>
	<h1>register.htmlì…ë‹ˆë‹¤.</h1>
	<hr>

	name 	 : <input type="text" id="name" name="name"><br>
	email 	 : <input type="text" id="email" name="email"><br>
	password : <input type="password" id="password" name="password"><br> <!-- ë¹„ë°€ë²ˆí˜¸í™•ì¸ì€ ì‚¬ìš©X -->
	
	<!-- csrf token -->
	<input type="hidden" id="_csrf" name="_csrf" value=""><br>
	
	<button id="btnRegister">Register</button>
	
<script>
	window.onload = function(){
		getCsrfToken();
		
		document.querySelector("#btnRegister").onclick = register;
	}
	
	// csrf controller ì— token ìš”ì²­
	async function getCsrfToken(){
		let response = await fetch("/csrf-token", {method: "get", credentials: "same-origin"});
		console.log(response);
		let data = await response.json();
		console.log(data);
		document.querySelector("#_csrf").value = data.token;
	}
	
	// ë¡œê·¸ì¸ 
	async function register(){
		
		let url = "/users"; // post ë°©ì‹ìœ¼ë¡œ /users : insertUser
		
		let name 	= document.querySelector("#name").value;
		let email 		= document.querySelector("#email").value;
		let password 	= document.querySelector("#password").value;
		let _csrf 	= document.querySelector("#_csrf").value;
		
		let urlParams = new URLSearchParams({
			name, email, password, _csrf  // javascript es6 shorthand property ë¬¸ë²•
		});
		
		let fetchOptions = {
			method: "post",
			body: urlParams
		}
		
		let response = await fetch(url, fetchOptions);
		let data = await response.json();
		
		console.log(data);
		
		if (data.result == "success") {
			alert("íšŒì›ê°€ì… ë˜ì—ˆìŠµë‹ˆë‹¤. \në¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤.")
			window.location.href="/login";
		}else {
			alert("íšŒì›ê°€ì… ë„ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤ğŸ’¥")
		}
		
		
	}
	
</script>	
</body>
</html>
<!-- csrf ì„¤ì • í›„ ë°›ì€ tokenì„ ì „ì†¡í•´ì•¼í•¨ 
	login2.htmlë¡œ ë³€ê²½ í›„ ìƒˆë¡œìš´ login.html ìƒì„±
 -->